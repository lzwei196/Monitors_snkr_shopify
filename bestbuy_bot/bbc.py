import requests
import json
import datetime
import time

url = "https://www.bestbuy.ca"
order_url = "https://www.bestbuy.ca/api/checkout/checkout/orders"
#bestbuy restocks at each quater
the_time = ["14","15","59","0","29","30","44","45","55","56"]

#i have taken out my credit card string and secureauthentication string incase i forgot to turn private LOL

class bestbuy:
    def __init__(self):
        self.session = requests.Session()
        lineItems = {}
        while True:
          # currentDT = datetime.datetime.now()
          # minute = str(currentDT.minute)
          # sec = str(currentDT.second)
          # if minute in the_time:
            try:
                lineItems = self.atc()
            except Exception as e:
                print(e)
            if lineItems[0]["total"] != 0 :
                try:
                    #obj = self.submit_shipping(lineItems)
                    #id = obj[0]
                    #totalPurchasePrice = obj[1]
                    id = lineItems[0]['id']
                    #self.submit_payment(id)
                    self.submit_order(id, '460.17')
                except Exception as e:
                    print(e)

    def atc(self):
        add_to_cart_url = "https://www.bestbuy.ca/api/basket/v2/baskets"
        data = {"lineItems":[{"sku":"13817625","quantity":1}]}
        headers = {
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "Content-Length":"47",
            "content-type": "application/json",
            "origin": "https://www.bestbuy.ca",
            "postal-code": "H3K",
            "region-code": "QC",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
           #"x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJmNDZjZjE1Ny04N2Q4LTQwZDMtOGQzNy0yYzA3ZjdhMDM3OGUifQ.0oSnniqudGcnuJa67TB2qI6wyid-erEO6BqRCd0YZfo"
        }
        r = self.session.post(add_to_cart_url, data=json.dumps(data), headers=headers)
        lineItems = json.loads(r.text)["shipments"][0]["lineItems"][0]
        id = json.loads(r.text)['id']
        obj ={}
        lineItems_format = []
        obj['id'] = id
        obj["lineItemType"]="Product"
        obj["name"]=lineItems["sku"]["product"]["name"]
        obj["offerId"]=lineItems["sku"]["offer"]["id"]
        obj["quantity"]= 1
        obj["sellerId"] = "bbyca"
        obj["sku"] = lineItems["sku"]["id"]
        obj["total"] = json.loads(r.text)["shipments"][0]["totalPrice"]
        lineItems_format.append(obj)
        #print(lineItems_format[0]["total"])
        return lineItems_format

    def start_checkout(self):
        headers = {
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "Content-Length": "47",
            "content-type": "application/json",
            "origin": "https://www.bestbuy.ca",
            "postal-code": "H3K",
            "region-code": "QC",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca"}
        r = self.session.get("https://www.bestbuy.ca/checkout/?qit=1#/en-ca/shipping/", headers=headers)
        print(r.text)
        print(self.session.cookies.get_dict())

    def submit_shipping(self,lineItems):
        order_url = 'https://www.bestbuy.ca/api/basket/v2/baskets/' + lineItems['id']
        data = {"email":"lzweijinwei196@gmail.com","shippingAddress":{"address":"1450, RENÉ-LÉVESQUE BLVD. WEST, 1510","apartmentNumber":"","city":"montreal","country":"CA","firstName":"ziwei","lastName":"li","phones":[{"ext":"","phone":"4387258504"}],"postalCode":"H3G0E1","province":"QC"}}
        data["lineItems"] = lineItems
        print(data)
        shipping_headers = {
            "accept": "application/vnd.bestbuy.checkout+json",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "content-Length":"477",
            "content-type": "application/json",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
            "cookie":"cookie: rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={\"currentUrlPath\":\"/en-ca/basket\",\"hasSurveyBeenDisplayed\":false,\"heartBeat\":1586292708,\"isInSampling\":false,\"pageViewCount\":4,\"surveyLastDisplayed\":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJiZTNkNGJlNi05MTlhLTQzYzAtYmQzYy1jMzBlNzcwOWI2NDAifQ.-CZjY90famiPhuWwCaRXE-notOWw6r0ZlG467JKDrmc; 3cb77e1367939b2c1a51f46cb3d4be5b=b29482b9b8508d5b13a1e75da3a0a12a; bm_mi=06E6CA2C944AA5733D908CD6708FAB0B~TYgdNNEKNVz0pmfBajxhnz85D+nGcz1ekJXwpuM+8Wxiz8tqC8GlLYoAChzTQ/nEZ1oAjwg3XdHUHjoHI3QK4CqqRw808XIVEfr5JLvzCqywlkxXjIrGg9xAOGs133/kQRFKmt/URdGIUigRCZp9mSiCmyWR7Bnm3OTMKBoBHqo5ZyboCeHNy/YUegVjcMB3yp0a9lI3U9mzCDoqoUBGIvSY+9+60pClL6FNN8S6/eY=; bm_sv=F6CF3667E0E5AB7AB2F275BC98955B54~UKUpNtMqQhOlBJ7pWmPxrWgFw55SVdv+cOJGFTZFXbPX3vf96jFidYrYxjIqYci9YMVia6As0XIx4qmPzZhljYZ5g64oUFJkN2wGpNefVgpdMTpbJbVObVaBS9PTnvBD29H03WenUjc1+fG2fQ+ExCUcCNm86Erd86MGLj07ZDg=; ak_bmsc=F9C619C16FB4730BCB3470940107336BB896608710130000DBC4985E0088A70E~pl0nPtMNLkqyCxF75i45OJ+EqhxKYCBzVRkH7X9RlM4W4d7wKz9vq1P9bNL0t3hFxDHlxT6UAOnuLT+njUzwe7ku47hT1KFQUB0X2hIRYpCaVzCiEaJfUn4M6ZqttjhIfgxC3ydrB481xlgqAOaVAoK35deBAPjN3ndrMEPoJY2AOBhPU1nyAZ7Om6Q8EiLyBa1qmOqzmaAFyMa4t+UEmLuU2VtLOBNg91cHwkpTLEWy1gp65xJfxlPnTOi8drB8KD",
            "referer": "https://www.bestbuy.ca/checkout/?qit=1",
            "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
           #'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
        }
        r = self.session.post(order_url,headers=shipping_headers,json=data)
        print(r.text)
        id = json.loads(r.text)["id"]
        totalPurchasePrice = json.loads(r.text)["totalPurchasePrice"]
        return [id,totalPurchasePrice]

    def submit_payment(self,id):
        url = "https://www.bestbuy.ca/api/checkout/checkout/orders/"+id+"/payments"
        data = {"email":"lzweijinwei196@gmail.com","payment":{"creditCard":{"billingAddress":{"address":"1450, RENÉ-LÉVESQUE BLVD. WEST, 1510","apartmentNumber":"","city":"montreal","country":"CA","firstName":"ziwei","lastName":"li","phones":[{"ext":"","phone":"4387258504"}],"postalCode":"H3G0E1","province":"QC"},"cardNumber":""}}}
        headers = {
            "accept": "application/vnd.bestbuy.checkout+json",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "content-Length": "744",
            "content-type": "application/json",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
           # "cookie": "cookie: rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={\"currentUrlPath\":\"/en-ca/basket\",\"hasSurveyBeenDisplayed\":false,\"heartBeat\":1586292708,\"isInSampling\":false,\"pageViewCount\":4,\"surveyLastDisplayed\":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJiZTNkNGJlNi05MTlhLTQzYzAtYmQzYy1jMzBlNzcwOWI2NDAifQ.-CZjY90famiPhuWwCaRXE-notOWw6r0ZlG467JKDrmc; 3cb77e1367939b2c1a51f46cb3d4be5b=b29482b9b8508d5b13a1e75da3a0a12a; bm_mi=06E6CA2C944AA5733D908CD6708FAB0B~TYgdNNEKNVz0pmfBajxhnz85D+nGcz1ekJXwpuM+8Wxiz8tqC8GlLYoAChzTQ/nEZ1oAjwg3XdHUHjoHI3QK4CqqRw808XIVEfr5JLvzCqywlkxXjIrGg9xAOGs133/kQRFKmt/URdGIUigRCZp9mSiCmyWR7Bnm3OTMKBoBHqo5ZyboCeHNy/YUegVjcMB3yp0a9lI3U9mzCDoqoUBGIvSY+9+60pClL6FNN8S6/eY=; bm_sv=F6CF3667E0E5AB7AB2F275BC98955B54~UKUpNtMqQhOlBJ7pWmPxrWgFw55SVdv+cOJGFTZFXbPX3vf96jFidYrYxjIqYci9YMVia6As0XIx4qmPzZhljYZ5g64oUFJkN2wGpNefVgpdMTpbJbVObVaBS9PTnvBD29H03WenUjc1+fG2fQ+ExCUcCNm86Erd86MGLj07ZDg=; ak_bmsc=F9C619C16FB4730BCB3470940107336BB896608710130000DBC4985E0088A70E~pl0nPtMNLkqyCxF75i45OJ+EqhxKYCBzVRkH7X9RlM4W4d7wKz9vq1P9bNL0t3hFxDHlxT6UAOnuLT+njUzwe7ku47hT1KFQUB0X2hIRYpCaVzCiEaJfUn4M6ZqttjhIfgxC3ydrB481xlgqAOaVAoK35deBAPjN3ndrMEPoJY2AOBhPU1nyAZ7Om6Q8EiLyBa1qmOqzmaAFyMa4t+UEmLuU2VtLOBNg91cHwkpTLEWy1gp65xJfxlPnTOi8drB8KD",
            "referer": "https://www.bestbuy.ca/checkout/?qit=1",
            "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
        }
        r = self.session.put(url,headers=headers,json=data)
        print(r.text)

    def submit_order(self, id, totalPurchasePrice):
        url = "https://www.bestbuy.ca/api/checkout/checkout/orders/submit"
        headers = {
            "accept": "application/vnd.bestbuy.checkout+json",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "content-Length": "5665",
            "content-type": "application/json",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
           # "cookie": "cookie: rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={\"currentUrlPath\":\"/en-ca/basket\",\"hasSurveyBeenDisplayed\":false,\"heartBeat\":1586292708,\"isInSampling\":false,\"pageViewCount\":4,\"surveyLastDisplayed\":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJiZTNkNGJlNi05MTlhLTQzYzAtYmQzYy1jMzBlNzcwOWI2NDAifQ.-CZjY90famiPhuWwCaRXE-notOWw6r0ZlG467JKDrmc; 3cb77e1367939b2c1a51f46cb3d4be5b=b29482b9b8508d5b13a1e75da3a0a12a; bm_mi=06E6CA2C944AA5733D908CD6708FAB0B~TYgdNNEKNVz0pmfBajxhnz85D+nGcz1ekJXwpuM+8Wxiz8tqC8GlLYoAChzTQ/nEZ1oAjwg3XdHUHjoHI3QK4CqqRw808XIVEfr5JLvzCqywlkxXjIrGg9xAOGs133/kQRFKmt/URdGIUigRCZp9mSiCmyWR7Bnm3OTMKBoBHqo5ZyboCeHNy/YUegVjcMB3yp0a9lI3U9mzCDoqoUBGIvSY+9+60pClL6FNN8S6/eY=; bm_sv=F6CF3667E0E5AB7AB2F275BC98955B54~UKUpNtMqQhOlBJ7pWmPxrWgFw55SVdv+cOJGFTZFXbPX3vf96jFidYrYxjIqYci9YMVia6As0XIx4qmPzZhljYZ5g64oUFJkN2wGpNefVgpdMTpbJbVObVaBS9PTnvBD29H03WenUjc1+fG2fQ+ExCUcCNm86Erd86MGLj07ZDg=; ak_bmsc=F9C619C16FB4730BCB3470940107336BB896608710130000DBC4985E0088A70E~pl0nPtMNLkqyCxF75i45OJ+EqhxKYCBzVRkH7X9RlM4W4d7wKz9vq1P9bNL0t3hFxDHlxT6UAOnuLT+njUzwe7ku47hT1KFQUB0X2hIRYpCaVzCiEaJfUn4M6ZqttjhIfgxC3ydrB481xlgqAOaVAoK35deBAPjN3ndrMEPoJY2AOBhPU1nyAZ7Om6Q8EiLyBa1qmOqzmaAFyMa4t+UEmLuU2VtLOBNg91cHwkpTLEWy1gp65xJfxlPnTOi8drB8KD",
            "referer": "https://www.bestbuy.ca/checkout/?qit=1",
            "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
        }
        #secureauthentication is a hell long string i dont know how it is generated, but seems like u need it when posting to the server
        data = {"cvv":"185","email":"lzweijinwei196@gmail.com","secureAuthenticationResponse":1}
        data["totalPurchasePrice"] = totalPurchasePrice
        data["id"] = id
        r = self.session.post(url, headers=headers,json=data)
        print(r.text)

bestbuy = bestbuy()
