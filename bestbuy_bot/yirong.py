import requests
import json
import datetime
import time
from shopifyMonitor import load_proxy, parse_proxy
import random

########################### General param ##########################
####REPLACE the address, credit card info in the submit shipping, payment and order section
#the cookie will be expired in an hour, haven't tested much, but this seems to be the case
#xtx is has to match
#the easiest way maybe go to the site and go through the whole atc and submit order process and manually grab all the information
#currently You should be getting res from each step, if not, change the cookie

url = "https://www.bestbuy.ca"
order_url = "https://www.bestbuy.ca/api/checkout/checkout/orders"
#bestbuy restocks at each quater
the_time = ["14","15","59","0","29","30","44","45","55","56"]
sku = "14962184"
cookie = \
        'bm_sz=36DE3658064310F2CC619161C16BE60A~YAAQx2CWuKTl6at1AQAAvgrMvAlQQQmIPKt8zzsZx9SxrrdcqmdSxO/7m/pHgJxUvDzTzPO6LEKzPmKSbPRmiuso/t7oqm3zHJLR04Pt5dD3cBiaM41JpQptzCP+aySOQtHmcXCrJ92sZTBGGbPoGtMHBeuaoerKWeB2ITfZFCu2V3TZB3rJ2/tDQJE6A8z0; GB_test=solr; rxVisitor=160519028969162HBJF5ICFKA1VB7B65QLEOE59OARARR; bm_mi=E041087CAF18D7A37715E5908BC2A61A~V7CL54oxXZ1d5aDMukfbjdEyOQbwWuRVCzjH6fFjJN/u93rej5hn/DhNlAun8pndYF684XFjaor/+MNrLkhBnYk68y7vdSooKpZ8C5ExsVXKB3s2FwHj7rtDJE3h8zaiJ40YGmdyKJvttu7kT/y/ak78BwpYo1LfskMiS68Tgc9OW75tZ4dRki1wzSzxScejNgnD/M0mSqTx0Ll5DoGYHtK70LQcNqKpI3OrP2NQPuEmyewYbNbUBIydwslO9Y1JUoJWbojmT6FSqvN6uDc74w==; ai_user=94uIZo2odlff+umBbBQCDa|2020-11-12T14:11:30.062Z; clientId=JDOJquh8l2hT1FQa; criteoVisitorId=2a8772db-475b-41a9-9a85-0dbda0c7d28e; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C51751417281803834992696735653268508947; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18579%7CMCMID%7C51751417281803834992696735653268508947%7CMCAAMLH-1605795090%7C7%7CMCAAMB-1605795090%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1605197490s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C3.3.0; __gads=ID=98d8cfda22191084:T=1605190291:S=ALNI_MZrJM-2biH4BxotjvGt22kGMLu6fw; _fbp=fb.1.1605190291167.560474564; ak_bmsc=BA90653F27A9C70E71CEF886F788C3E7B89660C78A1200009242AD5F60F0462D~plFFumc7HXDKEZTHVJnBmza7urvL34+Tq2rIzfC2C9utqIgklzXM2NUHD2FOnelgQNCSwAUC7bBkYKB536RiFaLBUmV9kCQ+KIEPsTvQQYQNI0kqJ/NLfavjPTAfGHpVTPxBhfDEETtuFOj2RixbAueVc5UWqcFk4/YtyFy/bMoOeA37MCshONbBqdKAziKKZ7dnyj+EAwwEa/TXYXNnXBe9BIRCspli5qsVEDYl4Qv206W6gTv9zoPPn8DxCFq39N; QueueITAccepted-SDFrts345E-V3_dryrun4b2020browse=EventId%3Ddryrun4b2020browse%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Ddisabled%26IssueTime%3D1605190291%26Hash%3D303cb17e4cf2e7d12e80cbbe2786c294c54917ad650075afd18eb4c2752810f5; _gcl_au=1.1.405666223.1605190291; check=true; dtm_mSession=e6f5cd10110a4e6a9cf7a434e0d65029; gbi_visitorId=ckhewurs900013b8ok55i07az; gbi_sessionId=ckhewurs900003b8o8j7djewz; _abck=7A4680B7547AABD50FB2AE4B25530EBE~0~YAAQx2CWuLrl6at1AQAAoRLMvAS1WvXb2Hs8NMxYYh5xZo7T/f2xcMtaFp4cyzq6A1cDTRVz5TPnI0kG0RcXL8yOLU+nxRioINeSVijDfnC8OYCvn2oYKDYvTPtAEEyEl2D71S+0GyFQpIZC52l4JIpeH0WtrCs8vZ47v9nI+s1tzB+0iuh1oOsAXSJzD1Zc0Sb4V4KgCN2KTnypn0jkSsPk6lOHRMxFTX0pi+twgUmkdWe1UgButQepSbhzsD5Ijq3t2D//p3dMflxkhCaxIb+d3lORYlbAng9RI5KoFFJtS1VYa+bH5T9Ryl43+e0cIBkCGCviYV+jZAOUm2tR0aqhsd3Ohg==~-1~||-1||~-1; s_lv_s=First%20Visit; s_vnum=1606798800730%26vn%3D1; s_invisit=true; AA_previousTA=; s_cc=true; _ga=GA1.2.1855541905.1605190291; _gid=GA1.2.1793548625.1605190292; _gat_gtag_UA_122294325_1=1; _pin_unauth=dWlkPU1qaGtPVGhtTlRFdE9UTXhOUzAwWkdZekxXSTROREF0WXpRNFl6STVPV05qWldZeQ; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyMjgxYTAwMi1mMzVmLTQ0ZjAtOGViZi1lMTY4OGU3Y2RjODEifQ.n7_MZEzXEKgyraXaMfzCe_YiRyUMsctRxb0RCPylcb4; fdb7491a5cc3d693edd0926b3a48659f=18600aedf7bbae8b39bcef9247311aea; dtLatC=3; s_fid=7AD706E4D700543F-3CEE03BDBBFD27B3; BVBRANDSID=09c94619-0553-4145-a038-26ef07beecdc; BVBRANDID=0e9418a0-b43d-489e-a4d8-f54471bebcc7; BVImplmain_site=18193; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1605190320,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1636726290}; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1605190322649%7C190300577_214%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1605190302334%7C%7C; AA_previousPageType=; s_sq=%5B%5BB%5D%5D; ai_session=xr++yimKnTgTJw3ZSF4cZP|1605190290678|1605190323583.1; rxVisitor=160519028969162HBJF5ICFKA1VB7B65QLEOE59OARARR; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1605190322649%7C190300577_214%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1605190302334%7C%7C; dtLatC=3; b6bab32db12a74433294191e1fddb23a=e8115415ae401cc767a8d7764167caa2; _derived_epik=dj0yJnU9eXZKRzJtaUlEb0N3SnE5RERKQjNuLURncXBnMENvLVEmbj1kM1ZoUU53ZHllcVZESXBoSUpTQlVRJm09NyZ0PUFBQUFBRi10UXJV; QueueITAccepted-SDFrts345E-V3_dryrun42020checkout=EventId%3Ddryrun42020checkout%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Ddisabled%26IssueTime%3D1605190325%26Hash%3Dfc5b8a4a75f2b5be44d3a5dd36502ccfe1fdaddb3e616ee1fa099b864ed328f2; dtPC=1$190324307_643h-vHUOKPHHKHQHMGCFHPMCONKMAPGDPWAKF-0e13; mbox=session#e6f5cd10110a4e6a9cf7a434e0d65029#1605192151|PC#e6f5cd10110a4e6a9cf7a434e0d65029.35_0#1668435128; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=7; s_lv=1605190327719; s_getNewRepeat=1605190327722-New; AA_previousCategory=dth%20checkout; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; dtCookie=1$40SDIPMJ88C7VU7HV43L6MRL4JMRB8P6|ea7c4b59f27d43eb|0; rxvt=1605192127746|1605190289692; bm_sv=99BD13D17C5008AD00EE2FD4250A451B~6iNRgE9LR4iSN281SPz8Ll0RkyfnCWVNrlUOBLZL1rEavRj66T9wA61YAykufmShjcREumV7kWNOx5J+JfW2P0U01j70PAgXn0V38qqS12ZshSf1LexhqPam0V676HM5lLYfX/6JkYGGIpEVKi86o75nqFojjeHacz1WtnZ3MDE=; dtCookie=1$40SDIPMJ88C7VU7HV43L6MRL4JMRB8P6|ea7c4b59f27d43eb|0; cartId=b4d43fb0-f672-4613-adec-8fb5b4a49e5a; dtPC=1$190324307_643h8vHUOKPHHKHQHMGCFHPMCONKMAPGDPWAKF-0e13; rxvt=1605192133363|1605190289692'
xtx = 'eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyMjgxYTAwMi1mMzVmLTQ0ZjAtOGViZi1lMTY4OGU3Y2RjODEifQ.n7_MZEzXEKgyraXaMfzCe_YiRyUMsctRxb0RCPylcb4'
####################################################################



class bestbuy:
    def __init__(self,proxy, proxyornot=True, oneonly = True):
        self.oneonly = oneonly
        self.proxy = proxy
        self.session = requests.Session()
        self.proxyornot = proxyornot
        lineItems = {}

        while True:
          # currentDT = datetime.datetime.now()
          # minute = str(currentDT.minute)
          # sec = str(currentDT.second)
          # if minute in the_time:
            try:
                lineItems = self.atc()
            except Exception as e:
                print(e)
                pass
            if lineItems[0]["total"] != 0 :
                try:
                    obj = self.submit_shipping(lineItems)
                    id = obj[0]
                    totalPurchasePrice = obj[1]
                    self.submit_payment(id)
                    if self.submit_order(id, totalPurchasePrice) and self.oneonly:
                        break
                    else:
                        pass
                except Exception as e:
                   print(e)
                   pass
            # sleep = random.randint(1, 10)
            # print(f"sleep {sleep}")
            # time.sleep(sleep)

    def atc(self):
        add_to_cart_url = "https://www.bestbuy.ca/api/basket/v2/baskets"
        data = {"lineItems":[{"sku":"","quantity":1}]}
        data["lineItems"][0]["sku"] = sku
        headers = {
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "Content-Length":"47",
            "content-type": "application/json",
            "origin": "https://www.bestbuy.ca",
            "postal-code": "H3G",
            "region-code": "QC",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
           #"x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJmNDZjZjE1Ny04N2Q4LTQwZDMtOGQzNy0yYzA3ZjdhMDM3OGUifQ.0oSnniqudGcnuJa67TB2qI6wyid-erEO6BqRCd0YZfo"
        }
        if self.proxyornot:
            r = self.session.post(add_to_cart_url, data=json.dumps(data), headers=headers, proxies=self.proxy)
        else:
            r = self.session.post(add_to_cart_url, data=json.dumps(data), headers=headers)
        print('############')
        print('adding' + sku + ' to cart')
        #print(r.text)
        lineItems = json.loads(r.text)["shipments"][0]["lineItems"][0]
        obj ={}
        lineItems_format = []
        obj["lineItemType"]="Product"
        obj["name"]=lineItems["sku"]["product"]["name"]
        obj["offerId"]=lineItems["sku"]["offer"]["id"]
        obj["quantity"]= 1
        obj["sellerId"] = "bbyca"
        obj["sku"] = lineItems["sku"]["id"]
        obj["total"] = json.loads(r.text)["shipments"][0]["totalPrice"]
        lineItems_format.append(obj)
        #print(lineItems_format[0]["total"])
        return  lineItems_format

    def start_checkout(self):
        headers = {
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "Content-Length": "47",
            "content-type": "application/json",
            "origin": "https://www.bestbuy.ca",
            "postal-code": "H3K",
            "region-code": "QC",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca"}
        r = self.session.get("https://www.bestbuy.ca/checkout/?qit=1#/en-ca/shipping/", headers=headers)
        print(r.text)
        print(self.session.cookies.get_dict())

    def submit_shipping(self,lineItems):
        data = {"email":"lzwei1996112@gmail.com", "shippingAddress":{"address":"1450 rene levesque 1510","apartmentNumber":"","city":"montreal","country":"CA","firstName":"yirong","lastName":"zhang","phones":[{"ext":"","phone":"4389298756"}],"postalCode":"h3g0e1","province":"QC"}}
        data["lineItems"] = lineItems
        print(data)
        shipping_headers = {
            "accept": "application/vnd.bestbuy.checkout+json",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "content-type": "application/json",
            "content-length":"493",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
            #"cookie":"clientId=LKW79mCc6IWh15uj; criteoVisitorId=4373ca22-d8b3-47e3-b95d-b4efdab250c0; s_ecid=MCMID%7C53412406115792407981988834282011167775; ai_user=uT/Y1|2020-09-26T22:45:19.755Z; gbi_visitorId=ckfk9iise00013b7zja1w2wem; BVBRANDID=d43954e6-773b-4a20-949b-f535ebc0fd37; _gcl_au=1.1.2052194769.1601160325; _ga=GA1.2.1267216390.1601160320; _pin_unauth=dWlkPU56SmpNVFppWWpZdE9XVTFNQzAwT0dReUxUbG1ZV1F0TWpZNE5tRmpaRGczTWpSbA; rxVisitor=1603645933792B0H5M61G6JUA2LPQLB62U14BTS40NNM0; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; _gcl_dc=GCL.1603645937.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; _gcl_aw=GCL.1603645937.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; _gac_UA-122294325-1=1.1603645941.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; s_ev46=%5B%5B%27knc-s-71700000055465044%27%2C%271601160324957%27%5D%2C%5B%27knc-s-71700000071852306%27%2C%271601519284827%27%5D%2C%5B%27knc-s-71700000065731896%27%2C%271601519312498%27%5D%2C%5B%27knc-s-71700000072655674%27%2C%271603645941045%27%5D%5D; s_cc=true; check=true; bm_mi=C956D62C091E3B40E4B5927D3A8DD920~JPJusPStPfy5PCCzkfSsDfJTuY1ZQD2CYfeGGfMfa6dzkm2d2/OKq3shWK0EO/lrSKz7kfz9oDrk6F9u4q5c6MPwiq/UPUCoatMpaOvmKUQ8xX9pyt1yovrVnzcNoLcwBeK7uGOSG8XzTvQHIDzfrinCpbyLYY8v2HZlTPv25/3KGLJi/MrWSubrd8XLi8+5k9jonRxk5j2nFsh5yMiUPQV+tgG1U/AlD7dhAcobUGN5X4O0xXGM1DniFGxLqNUvLqFVaiu/e6pbTHZjMe08lA==; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18564%7CMCMID%7C53412406115792407981988834282011167775%7CMCAAMLH-1604493789%7C7%7CMCAAMB-1604493789%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1603896189s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C3.3.0; ak_bmsc=F34B7C2D9E147F098073E80747FC6015B8966096790B00005D67995FFBB0C02E~plMBCWiDzGCSS47CMkDeDnpY67JcTD2GF0LJlEZHeiTSBABsFHo3L72946pZ3tRj9V/lxuPW++si4jUwfdGXGL/NYTcsa9lEhjLlCCd1bxH0AxYOrHxadHxFgOGL3FgAU9j24t3Zt6OuNLTaPPS0UxF5TMwQWOImql1gwHsf+5VtHdh3G2+HH9LbDn+QwH/jmKurqM3D8HN5AZY1VXEhiEu+f+oL2ers7xddlG7FQ4cEM9PWjDnxyx5JQpIxNNxeYs; _gid=GA1.2.976140257.1603888991; BVImplmain_site=18193; dtm_mSession=2b130163769f496bb9c49df67a16bf01; _gat_gtag_UA_122294325_1=1; gbi_sessionId=ckgti9g1800013b85xace2yjy; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Qu%c3%a9bec%22%2c%22postalCode%22%3a%22G1H%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Qu%c3%a9bec%22%2c%22postalCode%22%3a%22G1H%22%2c%22region%22%3a%22QC%22%7d%7d; dtLatC=1; s_lv_s=Less%20than%201%20day; s_vnum=1604203200574%26vn%3D6; s_invisit=true; AA_previousTA=; nps={'currentUrlPath':'/en-ca/basket','hasSurveyBeenDisplayed':false,'heartBeat':'1603896001','isInSampling':false,'pageViewCount':4,'surveyLastDisplayed':1632696319}; dtPC=1$93165733_79h-vNHLRABFJMMOKLWTJILRPTKEIVNHUJVRN-0e2; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1603896003043%7C93165733_79%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1603893172502%7C%7C; dtCookie=1$5MBEO19773S1N4CRTJC8D170A3EUDVHE|ea7c4b59f27d43eb|0; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIwNGU4MzE0MS01MjJlLTQ2NjUtYTMwNS0zNGM3MzBjYTcwZjAifQ.Iz0mUoe9n4hLz3EFYJPQ1BghcSjyX8sHuRRZ2Al7-z0; fdb7491a5cc3d693edd0926b3a48659f=4e9d755d4d178d67f3fc84c07bfb8d97; rxvt=1603897803305|1603894974879; AA_previousPageType=; s_sq=%5B%5BB%5D%5D; ai_session=iC0k5E2oH0EM1bwdu4DUwA|1603895992147|1603896007100.675; rxVisitor=1603645933792B0H5M61G6JUA2LPQLB62U14BTS40NNM0; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1603896003043%7C93165733_79%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1603893172502%7C%7C; b6bab32db12a74433294191e1fddb23a=33757115b51b0d3d8d213f0b5d5a4387; _derived_epik=dj0yJnU9b2VzdVo1NXBMdzVfRlBJVmRCN3dNekZNOGtKU092UDYmbj1LVnV6NHZHZnlZQnJhcXBxWm9uVXhBJm09NyZ0PUFBQUFBRi1aZ3Nn; 47236a0d189c10314faac13e28785259=bcded287772b27ed93b0f868a1c2112d; mbox=PC#13bed9d3bb2045d09a3a04d09dfb9d86.35_0#1667140811|session#2b130163769f496bb9c49df67a16bf01#1603897862; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=4; s_lv=1603896010667; s_getNewRepeat=1603896010669-Repeat; AA_previousCategory=dth%20checkout; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; bm_sv=2881C9ACC42CB051F085EFE2AD0222F3~zfYBPcGgFXyP2f8Cv3uc0sQwJ6foKHqgmglm/5ILd9aYW5mJqhuYamGL438tG2MENEDwTrWfEuZRYXPH/od6nroEibLnQNyDd4ClGQNpzLPj52nGuVO0NzTo6NCTYCwdCVAjoLA4Uo+5DGt1irhR7pxTZhGMHrFmuNDM7T9sGfY=; dtCookie=1$5MBEO19773S1N4CRTJC8D170A3EUDVHE|ea7c4b59f27d43eb|0; cartId=f95041c8-98d0-4cb3-b554-7ff2b600990a; dtLatC=4; dtPC=1$96007592_194h8vNHLRABFJMMOKLWTJILRPTKEIVNHUJVRN-0e2; rxvt=1603897814184|1603894974879",
            "referer": "https://www.bestbuy.ca/checkout/",
            #"x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            "x-dtreferer": "https://www.bestbuy.ca/checkout/#/en-ca/shipping/QC/H3G0E1",
            'cookie':cookie,
            #"x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            #'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
            #'cookie':'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
            "x-tx":xtx
        }
        if self.proxyornot:
            r = self.session.post(order_url, headers=shipping_headers, json=data, proxies=self.proxy)
        else:
            r = self.session.post(order_url,headers=shipping_headers,json=data)
        print("#######################")
        print('submit shipping')
        print(r.text)
        id = json.loads(r.text)["id"]
        totalPurchasePrice = json.loads(r.text)["totalPurchasePrice"]
        return [id, totalPurchasePrice]

    def submit_payment(self,id):
        url = "https://www.bestbuy.ca/api/checkout/checkout/orders/"+id+"/payments"
        data = {"email":"lzwei1996112@gmail.com","payment":{"creditCard":{"billingAddress":{"address":"1450 rene levesque 1510","apartmentNumber":"","city":"montreal","country":"CA","email":"lzwei1996112@gmail.com","firstName":"yirong","lastName":"zhang","phones":[{"ext":"","phone":"4389298756"}],"postalCode":"h3g0e1","province":"QC"},"cardNumber":"B+RlSBhqRlhGe5UWEpghWFsllzPAHYamxH28K0fwajlj8TVz4FF9WCReKCHiDxlJYOU2ZlcwZD7x/tLY/aogPY5i4/4rbIRs3jAyr7wZH4vQwz3EO1F1vowNDKMmL5PYiKru36zWHUC0TOf2zIJJ19aRaxW77oWevW7fZyZpw4Mw3dTjMLXOz+os50xhPQbZBVWLoTWbtKz1RNT29VlOzjmbnMO1onR80mkWq5zUIq3dePlIUZEPc+xsUClO0hDwHlJmjAL3Hz5ezFXXv9N/2IW5FmmjwmFoREx4guOM4gbw+db9DCXnT7ifcmzUdK1QRiAFp6Fm1g9/oBQyMv73KA==1900","cardType":"MC","cvv":"144","expirationMonth":"8","expirationYear":"2022"}}}
        # headers = {
        #     "accept": "application/vnd.bestbuy.checkout+json",
        #     "accept-encoding": "gzip, deflate, br",
        #     "accept-language": "en-CA",
        #     "content-Length": "779",
        #     "content-type": "application/json",
        #     "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
        #     "Host": "www.bestbuy.ca",
        #     'cookie':'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f',
        #     "referer": "https://www.bestbuy.ca/checkout/",
        #     "x-dtreferer": "https://www.bestbuy.ca/checkout/#/en-ca/payment",
        #     "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
        #     #'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
        # }
        headers = {
            "accept": "application/vnd.bestbuy.checkout+json",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "content-type": "application/json",
            "content-length": "493",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
            # "cookie":"clientId=LKW79mCc6IWh15uj; criteoVisitorId=4373ca22-d8b3-47e3-b95d-b4efdab250c0; s_ecid=MCMID%7C53412406115792407981988834282011167775; ai_user=uT/Y1|2020-09-26T22:45:19.755Z; gbi_visitorId=ckfk9iise00013b7zja1w2wem; BVBRANDID=d43954e6-773b-4a20-949b-f535ebc0fd37; _gcl_au=1.1.2052194769.1601160325; _ga=GA1.2.1267216390.1601160320; _pin_unauth=dWlkPU56SmpNVFppWWpZdE9XVTFNQzAwT0dReUxUbG1ZV1F0TWpZNE5tRmpaRGczTWpSbA; rxVisitor=1603645933792B0H5M61G6JUA2LPQLB62U14BTS40NNM0; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; _gcl_dc=GCL.1603645937.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; _gcl_aw=GCL.1603645937.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; _gac_UA-122294325-1=1.1603645941.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; s_ev46=%5B%5B%27knc-s-71700000055465044%27%2C%271601160324957%27%5D%2C%5B%27knc-s-71700000071852306%27%2C%271601519284827%27%5D%2C%5B%27knc-s-71700000065731896%27%2C%271601519312498%27%5D%2C%5B%27knc-s-71700000072655674%27%2C%271603645941045%27%5D%5D; s_cc=true; check=true; bm_mi=C956D62C091E3B40E4B5927D3A8DD920~JPJusPStPfy5PCCzkfSsDfJTuY1ZQD2CYfeGGfMfa6dzkm2d2/OKq3shWK0EO/lrSKz7kfz9oDrk6F9u4q5c6MPwiq/UPUCoatMpaOvmKUQ8xX9pyt1yovrVnzcNoLcwBeK7uGOSG8XzTvQHIDzfrinCpbyLYY8v2HZlTPv25/3KGLJi/MrWSubrd8XLi8+5k9jonRxk5j2nFsh5yMiUPQV+tgG1U/AlD7dhAcobUGN5X4O0xXGM1DniFGxLqNUvLqFVaiu/e6pbTHZjMe08lA==; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18564%7CMCMID%7C53412406115792407981988834282011167775%7CMCAAMLH-1604493789%7C7%7CMCAAMB-1604493789%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1603896189s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C3.3.0; ak_bmsc=F34B7C2D9E147F098073E80747FC6015B8966096790B00005D67995FFBB0C02E~plMBCWiDzGCSS47CMkDeDnpY67JcTD2GF0LJlEZHeiTSBABsFHo3L72946pZ3tRj9V/lxuPW++si4jUwfdGXGL/NYTcsa9lEhjLlCCd1bxH0AxYOrHxadHxFgOGL3FgAU9j24t3Zt6OuNLTaPPS0UxF5TMwQWOImql1gwHsf+5VtHdh3G2+HH9LbDn+QwH/jmKurqM3D8HN5AZY1VXEhiEu+f+oL2ers7xddlG7FQ4cEM9PWjDnxyx5JQpIxNNxeYs; _gid=GA1.2.976140257.1603888991; BVImplmain_site=18193; dtm_mSession=2b130163769f496bb9c49df67a16bf01; _gat_gtag_UA_122294325_1=1; gbi_sessionId=ckgti9g1800013b85xace2yjy; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Qu%c3%a9bec%22%2c%22postalCode%22%3a%22G1H%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Qu%c3%a9bec%22%2c%22postalCode%22%3a%22G1H%22%2c%22region%22%3a%22QC%22%7d%7d; dtLatC=1; s_lv_s=Less%20than%201%20day; s_vnum=1604203200574%26vn%3D6; s_invisit=true; AA_previousTA=; nps={'currentUrlPath':'/en-ca/basket','hasSurveyBeenDisplayed':false,'heartBeat':'1603896001','isInSampling':false,'pageViewCount':4,'surveyLastDisplayed':1632696319}; dtPC=1$93165733_79h-vNHLRABFJMMOKLWTJILRPTKEIVNHUJVRN-0e2; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1603896003043%7C93165733_79%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1603893172502%7C%7C; dtCookie=1$5MBEO19773S1N4CRTJC8D170A3EUDVHE|ea7c4b59f27d43eb|0; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIwNGU4MzE0MS01MjJlLTQ2NjUtYTMwNS0zNGM3MzBjYTcwZjAifQ.Iz0mUoe9n4hLz3EFYJPQ1BghcSjyX8sHuRRZ2Al7-z0; fdb7491a5cc3d693edd0926b3a48659f=4e9d755d4d178d67f3fc84c07bfb8d97; rxvt=1603897803305|1603894974879; AA_previousPageType=; s_sq=%5B%5BB%5D%5D; ai_session=iC0k5E2oH0EM1bwdu4DUwA|1603895992147|1603896007100.675; rxVisitor=1603645933792B0H5M61G6JUA2LPQLB62U14BTS40NNM0; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1603896003043%7C93165733_79%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1603893172502%7C%7C; b6bab32db12a74433294191e1fddb23a=33757115b51b0d3d8d213f0b5d5a4387; _derived_epik=dj0yJnU9b2VzdVo1NXBMdzVfRlBJVmRCN3dNekZNOGtKU092UDYmbj1LVnV6NHZHZnlZQnJhcXBxWm9uVXhBJm09NyZ0PUFBQUFBRi1aZ3Nn; 47236a0d189c10314faac13e28785259=bcded287772b27ed93b0f868a1c2112d; mbox=PC#13bed9d3bb2045d09a3a04d09dfb9d86.35_0#1667140811|session#2b130163769f496bb9c49df67a16bf01#1603897862; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=4; s_lv=1603896010667; s_getNewRepeat=1603896010669-Repeat; AA_previousCategory=dth%20checkout; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; bm_sv=2881C9ACC42CB051F085EFE2AD0222F3~zfYBPcGgFXyP2f8Cv3uc0sQwJ6foKHqgmglm/5ILd9aYW5mJqhuYamGL438tG2MENEDwTrWfEuZRYXPH/od6nroEibLnQNyDd4ClGQNpzLPj52nGuVO0NzTo6NCTYCwdCVAjoLA4Uo+5DGt1irhR7pxTZhGMHrFmuNDM7T9sGfY=; dtCookie=1$5MBEO19773S1N4CRTJC8D170A3EUDVHE|ea7c4b59f27d43eb|0; cartId=f95041c8-98d0-4cb3-b554-7ff2b600990a; dtLatC=4; dtPC=1$96007592_194h8vNHLRABFJMMOKLWTJILRPTKEIVNHUJVRN-0e2; rxvt=1603897814184|1603894974879",
            "referer": "https://www.bestbuy.ca/checkout/",
            # "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            "x-dtreferer": "https://www.bestbuy.ca/checkout/#/en-ca/shipping/QC/H3G0E1",
            # "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            # 'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
            # 'cookie':'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
            'cookie': cookie,
            "x-tx": xtx
        }
        if self.proxyornot:
            r = self.session.put(url,headers=headers,json=data, proxies = self.proxy)
        else:
            r = self.session.put(url,headers=headers,json=data)
        print('############')
        print('submit payment')
        print(r.text)

    def submit_order(self,id,totalPurchasePrice):
        url = "https://www.bestbuy.ca/api/checkout/checkout/orders/submit"
        # headers = {
        #     "accept": "application/vnd.bestbuy.checkout+json",
        #     "accept-encoding": "gzip, deflate, br",
        #     "accept-language": "en-CA",
        #     "content-Length": "5665",
        #     "content-type": "application/json",
        #     "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
        #     "Host": "www.bestbuy.ca",
        #    # "cookie": "cookie: rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={\"currentUrlPath\":\"/en-ca/basket\",\"hasSurveyBeenDisplayed\":false,\"heartBeat\":1586292708,\"isInSampling\":false,\"pageViewCount\":4,\"surveyLastDisplayed\":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJiZTNkNGJlNi05MTlhLTQzYzAtYmQzYy1jMzBlNzcwOWI2NDAifQ.-CZjY90famiPhuWwCaRXE-notOWw6r0ZlG467JKDrmc; 3cb77e1367939b2c1a51f46cb3d4be5b=b29482b9b8508d5b13a1e75da3a0a12a; bm_mi=06E6CA2C944AA5733D908CD6708FAB0B~TYgdNNEKNVz0pmfBajxhnz85D+nGcz1ekJXwpuM+8Wxiz8tqC8GlLYoAChzTQ/nEZ1oAjwg3XdHUHjoHI3QK4CqqRw808XIVEfr5JLvzCqywlkxXjIrGg9xAOGs133/kQRFKmt/URdGIUigRCZp9mSiCmyWR7Bnm3OTMKBoBHqo5ZyboCeHNy/YUegVjcMB3yp0a9lI3U9mzCDoqoUBGIvSY+9+60pClL6FNN8S6/eY=; bm_sv=F6CF3667E0E5AB7AB2F275BC98955B54~UKUpNtMqQhOlBJ7pWmPxrWgFw55SVdv+cOJGFTZFXbPX3vf96jFidYrYxjIqYci9YMVia6As0XIx4qmPzZhljYZ5g64oUFJkN2wGpNefVgpdMTpbJbVObVaBS9PTnvBD29H03WenUjc1+fG2fQ+ExCUcCNm86Erd86MGLj07ZDg=; ak_bmsc=F9C619C16FB4730BCB3470940107336BB896608710130000DBC4985E0088A70E~pl0nPtMNLkqyCxF75i45OJ+EqhxKYCBzVRkH7X9RlM4W4d7wKz9vq1P9bNL0t3hFxDHlxT6UAOnuLT+njUzwe7ku47hT1KFQUB0X2hIRYpCaVzCiEaJfUn4M6ZqttjhIfgxC3ydrB481xlgqAOaVAoK35deBAPjN3ndrMEPoJY2AOBhPU1nyAZ7Om6Q8EiLyBa1qmOqzmaAFyMa4t+UEmLuU2VtLOBNg91cHwkpTLEWy1gp65xJfxlPnTOi8drB8KD",
        #     "referer": "https://www.bestbuy.ca/checkout/",
        #     "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
        #     'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
        # }
        headers = {
            "accept": "application/vnd.bestbuy.checkout+json",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "en-CA",
            "content-type": "application/json",
            "content-length": "493",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36",
            "Host": "www.bestbuy.ca",
            # "cookie":"clientId=LKW79mCc6IWh15uj; criteoVisitorId=4373ca22-d8b3-47e3-b95d-b4efdab250c0; s_ecid=MCMID%7C53412406115792407981988834282011167775; ai_user=uT/Y1|2020-09-26T22:45:19.755Z; gbi_visitorId=ckfk9iise00013b7zja1w2wem; BVBRANDID=d43954e6-773b-4a20-949b-f535ebc0fd37; _gcl_au=1.1.2052194769.1601160325; _ga=GA1.2.1267216390.1601160320; _pin_unauth=dWlkPU56SmpNVFppWWpZdE9XVTFNQzAwT0dReUxUbG1ZV1F0TWpZNE5tRmpaRGczTWpSbA; rxVisitor=1603645933792B0H5M61G6JUA2LPQLB62U14BTS40NNM0; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; _gcl_dc=GCL.1603645937.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; _gcl_aw=GCL.1603645937.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; _gac_UA-122294325-1=1.1603645941.Cj0KCQjwxNT8BRD9ARIsAJ8S5xa6-3EE7PabN3Rbyv6e9SyQbvceyfbHX2nYBmuGb3h6ecUI_bgLR9waAiO9EALw_wcB; s_ev46=%5B%5B%27knc-s-71700000055465044%27%2C%271601160324957%27%5D%2C%5B%27knc-s-71700000071852306%27%2C%271601519284827%27%5D%2C%5B%27knc-s-71700000065731896%27%2C%271601519312498%27%5D%2C%5B%27knc-s-71700000072655674%27%2C%271603645941045%27%5D%5D; s_cc=true; check=true; bm_mi=C956D62C091E3B40E4B5927D3A8DD920~JPJusPStPfy5PCCzkfSsDfJTuY1ZQD2CYfeGGfMfa6dzkm2d2/OKq3shWK0EO/lrSKz7kfz9oDrk6F9u4q5c6MPwiq/UPUCoatMpaOvmKUQ8xX9pyt1yovrVnzcNoLcwBeK7uGOSG8XzTvQHIDzfrinCpbyLYY8v2HZlTPv25/3KGLJi/MrWSubrd8XLi8+5k9jonRxk5j2nFsh5yMiUPQV+tgG1U/AlD7dhAcobUGN5X4O0xXGM1DniFGxLqNUvLqFVaiu/e6pbTHZjMe08lA==; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18564%7CMCMID%7C53412406115792407981988834282011167775%7CMCAAMLH-1604493789%7C7%7CMCAAMB-1604493789%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1603896189s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C3.3.0; ak_bmsc=F34B7C2D9E147F098073E80747FC6015B8966096790B00005D67995FFBB0C02E~plMBCWiDzGCSS47CMkDeDnpY67JcTD2GF0LJlEZHeiTSBABsFHo3L72946pZ3tRj9V/lxuPW++si4jUwfdGXGL/NYTcsa9lEhjLlCCd1bxH0AxYOrHxadHxFgOGL3FgAU9j24t3Zt6OuNLTaPPS0UxF5TMwQWOImql1gwHsf+5VtHdh3G2+HH9LbDn+QwH/jmKurqM3D8HN5AZY1VXEhiEu+f+oL2ers7xddlG7FQ4cEM9PWjDnxyx5JQpIxNNxeYs; _gid=GA1.2.976140257.1603888991; BVImplmain_site=18193; dtm_mSession=2b130163769f496bb9c49df67a16bf01; _gat_gtag_UA_122294325_1=1; gbi_sessionId=ckgti9g1800013b85xace2yjy; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Qu%c3%a9bec%22%2c%22postalCode%22%3a%22G1H%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Qu%c3%a9bec%22%2c%22postalCode%22%3a%22G1H%22%2c%22region%22%3a%22QC%22%7d%7d; dtLatC=1; s_lv_s=Less%20than%201%20day; s_vnum=1604203200574%26vn%3D6; s_invisit=true; AA_previousTA=; nps={'currentUrlPath':'/en-ca/basket','hasSurveyBeenDisplayed':false,'heartBeat':'1603896001','isInSampling':false,'pageViewCount':4,'surveyLastDisplayed':1632696319}; dtPC=1$93165733_79h-vNHLRABFJMMOKLWTJILRPTKEIVNHUJVRN-0e2; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1603896003043%7C93165733_79%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1603893172502%7C%7C; dtCookie=1$5MBEO19773S1N4CRTJC8D170A3EUDVHE|ea7c4b59f27d43eb|0; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIwNGU4MzE0MS01MjJlLTQ2NjUtYTMwNS0zNGM3MzBjYTcwZjAifQ.Iz0mUoe9n4hLz3EFYJPQ1BghcSjyX8sHuRRZ2Al7-z0; fdb7491a5cc3d693edd0926b3a48659f=4e9d755d4d178d67f3fc84c07bfb8d97; rxvt=1603897803305|1603894974879; AA_previousPageType=; s_sq=%5B%5BB%5D%5D; ai_session=iC0k5E2oH0EM1bwdu4DUwA|1603895992147|1603896007100.675; rxVisitor=1603645933792B0H5M61G6JUA2LPQLB62U14BTS40NNM0; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1603896003043%7C93165733_79%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1603893172502%7C%7C; b6bab32db12a74433294191e1fddb23a=33757115b51b0d3d8d213f0b5d5a4387; _derived_epik=dj0yJnU9b2VzdVo1NXBMdzVfRlBJVmRCN3dNekZNOGtKU092UDYmbj1LVnV6NHZHZnlZQnJhcXBxWm9uVXhBJm09NyZ0PUFBQUFBRi1aZ3Nn; 47236a0d189c10314faac13e28785259=bcded287772b27ed93b0f868a1c2112d; mbox=PC#13bed9d3bb2045d09a3a04d09dfb9d86.35_0#1667140811|session#2b130163769f496bb9c49df67a16bf01#1603897862; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=4; s_lv=1603896010667; s_getNewRepeat=1603896010669-Repeat; AA_previousCategory=dth%20checkout; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; bm_sv=2881C9ACC42CB051F085EFE2AD0222F3~zfYBPcGgFXyP2f8Cv3uc0sQwJ6foKHqgmglm/5ILd9aYW5mJqhuYamGL438tG2MENEDwTrWfEuZRYXPH/od6nroEibLnQNyDd4ClGQNpzLPj52nGuVO0NzTo6NCTYCwdCVAjoLA4Uo+5DGt1irhR7pxTZhGMHrFmuNDM7T9sGfY=; dtCookie=1$5MBEO19773S1N4CRTJC8D170A3EUDVHE|ea7c4b59f27d43eb|0; cartId=f95041c8-98d0-4cb3-b554-7ff2b600990a; dtLatC=4; dtPC=1$96007592_194h8vNHLRABFJMMOKLWTJILRPTKEIVNHUJVRN-0e2; rxvt=1603897814184|1603894974879",
            "referer": "https://www.bestbuy.ca/checkout/",
            # "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            "x-dtreferer": "https://www.bestbuy.ca/checkout/#/en-ca/shipping/QC/H3G0E1",
            # "x-tx": "eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo",
            # 'cookie': 'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
            # 'cookie':'rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; AMCVS_D6E638125859683E0A495D2D%40AdobeOrg=1; s_ecid=MCMID%7C86301909305537420292522418325688314886; clientId=nSWenUUFu9LCsF7h; criteoVisitorId=6d567f78-647d-454f-8c1c-5f69440224e8; enabled=1; ReturnUrl=https://www.bestbuy.ca/; surveyOptOut=1; ai_user=FyuDQ|2020-04-07T18:42:14.442Z; BVBRANDID=e708a65e-4651-4c13-b8f9-643934cbd3d6; _fbp=fb.1.1586284937175.1490006803; s_cc=true; check=true; aam_uuid=86071685624051341682573588122486112659; _gcl_au=1.1.50370926.1586284938; _ga=GA1.2.1778786793.1586284934; _gid=GA1.2.59619382.1586284938; BVImplmain_site=18193; __gads=ID=48c7ba964919b01b:T=1586284933:S=ALNI_MaEWqkaMCXajItYR_MdCK2FV8O0Fg; CS_Culture=en-CA; lastUsedLocations=%7b%22shippingLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%2c%22pickupLocation%22%3a%7b%22city%22%3a%22Montr%c3%a9al%22%2c%22postalCode%22%3a%22H3K%22%2c%22region%22%3a%22QC%22%7d%7d; tx=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NjZmNDlmNy01MmNhLTQ5YmQtYTZjZi0wMTA4NzU1MDNlMTUifQ.CsMAVW85JR97WyRgeNLx9nME0cgYIwaLL1n5DvjGepo; fdb7491a5cc3d693edd0926b3a48659f=5d1f449fef6e21babd7e36c3b0a1df14; rxVisitor=1586284932701BKU14G3B9REQKSF1GGC2IBES92PHH1KH; b6bab32db12a74433294191e1fddb23a=59f47724f688c74e7ad84e8220bf16f4; 3cb77e1367939b2c1a51f46cb3d4be5b=b4bb7e6220cccbdd59ecd36800d39361; dtm_mSession=0b341067d3f94f37ac1bc5e0c28413f0; s_lv_s=Less%20than%201%20day; s_vnum=1588305600678%26vn%3D3; s_invisit=true; AA_previousTA=; QueueITAccepted-SDFrts345E-V3_20191224xmas=EventId%3D20191224xmas%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292459%26Hash%3Db6e9b9e832c117fa3570f2dac9b546a847a22022d4cbc117a38a9199c733feef; AMCV_D6E638125859683E0A495D2D%40AdobeOrg=-1303530583%7CMCIDTS%7C18360%7CMCMID%7C86301909305537420292522418325688314886%7CMCAAMLH-1586897260%7C7%7CMCAAMB-1586897260%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1586299660s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18367%7CvVersion%7C3.3.0; BVBRANDSID=0cae47d0-133f-4c52-bd47-723e07c43e12; nps={"currentUrlPath":"/en-ca/basket","hasSurveyBeenDisplayed":false,"heartBeat":1586292708,"isInSampling":false,"pageViewCount":4,"surveyLastDisplayed":1617820934}; _gat_gtag_UA_122294325_1=1; dtSa=true%7CC%7C-1%7CContinue%20to%20Checkout%7C-%7C1586292718498%7C492611326_438%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fen-ca%2Fbasket%7CYour%20Cart%20-%20Best%20Buy%20Canada%20%5Ep%20Best%20Buy%20Canada%7C1586292618939%7C; s_sq=%5B%5BB%5D%5D; dtSa=true%7CC%7C-1%7CCart%7C-%7C1586291493912%7C489427974_154%7Chttps%3A%2F%2Fwww.bestbuy.ca%2Fcheckout%2F%3Fqit%3D1%7CSecure%20Checkout%20-%20Best%20Buy%20Canada%7C1586289433043%7C%2Fen-ca%2Fpayment; dtLatC=3; QueueITAccepted-SDFrts345E-V3_mth2019boxingday=EventId%3Dmth2019boxingday%26QueueId%3D00000000-0000-0000-0000-000000000000%26RedirectType%3Dafterevent%26IssueTime%3D1586292721%26Hash%3Dd5d9f2db51f6a2ec079f9f8241726b355ee32629dca626465098db0bc95a26e8; dtPC=1$492721585_165h-vENMPMLRFSXJOROTMKPIFGSRUPKTMLSGQ; mbox=PC#b0f75415079048518a51085098d36e59.28_0#1649537525|session#0b341067d3f94f37ac1bc5e0c28413f0#1586293356; AA_hasSeenCheckoutThisVisit=true; AA_pagePathingCount=8; s_lv=1586292724765; s_getNewRepeat=1586292724769-Repeat; AA_previousPageName=checkout%20|dth%20checkout%20|shipping; AA_previousCategory=dth%20checkout; AA_previousPageType=checkout; ai_session=xTxVo|1586291497169|1586292724974.945; dtCookie=1$58LAFJH1KKEOAGN4DEI42QMHN2J9KV4A|ea7c4b59f27d43eb|1; rxvt=1586294526700|1586291414500; cartId=4b80e997-f8c8-4b34-b34f-de7181c9905f'
            'cookie': cookie,
            "x-tx": xtx
        }
        data = {"cvv": "144", "email": "lzwei1996112@gmail.com",
                "secureAuthenticationResponse": "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",
                "totalPurchasePrice": totalPurchasePrice, "id": id}
        if self.proxyornot:
            r = self.session.post(url, headers=headers, json=data, proxies=self.proxy)
        else:
            r = self.session.post(url, headers=headers,json=data)
        order_detail = json.loads(r.text)
        print("#################")
        print('submit order')
        print(order_detail)
        if order_detail['orderNumber'] != 'null' and order_detail['orderNumber'] != None:
            print('order ' + order_detail['orderNumber'] + " Successfully placed")
            return True
        else:
            print('order failed, retrying')
            return False

proxies = load_proxy('proxy.text')
while True:
    the_proxy = parse_proxy(random.choice(proxies))
    try:
        #When creating the bestbuy obj, its default to use proxy and only checkout once, u can pass in different params.
        bestbuy = bestbuy(the_proxy, False)
    except Exception as e:
        pass
